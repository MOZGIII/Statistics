<% require 'yaml' %>

<% global = YAML.load_file("data/global.yaml") %>
<% data = YAML.load_file("data/#{global['variant']}.yaml") %>

<% require 'statistic' %>
<% require 'latex_helper' %>
<% include LatexHelper %>

<%
sample = {}
for i in 1 .. 4
  sample[i] = Statistic::Sample::new(data[i]['data'])
  sample[i].hist_step = data[i]['histstep'] if data[i]['histstep']
  sample[i].hist_start  = data[i]['histstart'] if data[i]['histstart']
end
%>

<%
def dist_name(dist)
  return "равномерном"      if dist.kind_of?(Statistic::Uniform)
  return "экспоненциальном" if dist.kind_of?(Statistic::Exponential)
  return "нормальном"
end
%>

\subsection*{\hspace*{\parindent}Задание 1} 
Для данных двух выборок (табл.~\ref{tab:1}) построить эмпирические функции 
распределения и гистограммы относительных частот. С помощью эмпирической 
функции распределения, нормальной и экспоненциальной вероятностных бумаг 
для каждой выборки определить вид закона распределения (нормальное, 
экспоненциальное, равномерное) и оценить его параметры. 

\par
{\em Решение.}
Эмпирической функцией распределения случайной величины $\xi$ 
называется функция $F_\text{э}(x) = P_\text{э}(\xi < x) = \dfrac{n_x}{n}$, 
которая при каждом $x$ равна отношению $n_x$~--- числа наблюдений, 
меньших $x$, к объему выборки $n$.
Значения данных в каждой выборке упорядочиваются по возрастанию 
(табл. ~\ref{tab:2}).
Объем <% if sample[1].size == sample[2].size %>
каждой выборки $n = <%= sample[1].size %>$,
<% else %> первой выборки~--- $<%= sample[1].size %>$, 
а второй~--- $<%= sample[2].size %>$,
<% end %> поэтому $F_\text{э}$~--- ступенчатая функция, увеличивающая 
свое значение на $\dfrac{1}{n}$ при каждом значении $x$, вошедшем в выборку. 
Построим графики $F_\text{э}(x)$ для обеих выборок (рис.~\ref{pic1}~и~\ref{pic2}).

\begin{table}[h]
  \begin{minipage}[h]{0.49\linewidth}
    \caption{Неупорядоченные выборки 1 и 2.}\label{tab:1}
  \end{minipage}
  \begin{minipage}[h]{0.49\linewidth}
    \caption{Отсортированные выборки 1 и 2.}\label{tab:2}
  \end{minipage}
  \begin{minipage}[h]{0.49\linewidth}
    \begin{center}
      \begin{tabular}{|c|}
        \hline
        Выборка 1 \\
        \hline 
        <% sample[1].data.each do |x| %>
          $<% if x >= 0.0 %>\phantom{-}<% end %><%= x %>$ \\
          \hline 
        <% end %>
      \end{tabular}
      \hspace*{1em}
      \begin{tabular}{|c|}
        \hline
        Выборка 2 \\
        \hline 
        <% sample[2].data.each do |x| %>
          $<%= x %>$ \\
          \hline 
        <% end %>
      \end{tabular}
    \end{center}
  \end{minipage}
  \hfill
  \begin{minipage}[h]{0.49\linewidth}
    \begin{center}
      \begin{tabular}{|c|}
        \hline
        Выборка 1 \\
        \hline 
        <% sample[1].sort.each do |x| %>
          $<% if x >= 0.0 %>\phantom{-}<% end %><%= x %>$ \\
          \hline 
        <% end %>
      \end{tabular}
      \hspace*{1em}
      \begin{tabular}{|c|}
        \hline
        Выборка 2 \\
        \hline 
        <% sample[2].sort.each do |x| %>
          $<%= x %>$ \\
          \hline 
        <% end %>
      \end{tabular}
    \end{center}
  \end{minipage}
\end{table}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.1.eps}
  \caption{Эмпирическая функция распределения выборки 1.}\label{pic1}
\end{figure}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.2.eps}
  \caption{Эмпирическая функция распределения выборки 2.}\label{pic2}
\end{figure}

\par
Гистограмма относительных частот является ступенчатым приближением 
плотности распределения случайной величины $\xi$. Для ее построения 
разделим весь диапазон наблюдений на $s$ полуинтервалов вида 
$[a_{j-1}; a_j)$ и определим количество наблюдений $m_j$, попавших в 
$j$-й в полуинтервал. Относительная частота наблюдений, попавших 
в $j$-й полуинтервал, равна $P_j^* = \dfrac{m_j}{n}$. 
Так как $m_1 + \cdots + m_s = n$, то сумма всех частот равна единице: 
$\sum\limits_{j=1}^{s} P_j^* = \sum\limits_{j=1}^{s} \dfrac{m_j}{n} = 
\dfrac{1}{n} \cdot \sum\limits_{j=1}^{s} m_j = \dfrac{1}{n} \cdot n = 1$.
Над каждым полуинтервалом $j$ построим прямоугольник высоты 
$h_j = \dfrac{m_j}{n(a_j-a_{j-1})}$. Полученная фигура, состоящая 
из этих прямоугольников, называется гистограммой относительных частот. 
Ее площадь должна быть равна единице. Соответственно, площадь каждого 
прямоугольника равна относительной частоте наблюдений $P_j^*$, 
попавших в этот интервал.

\par
Для построения гистограмм следует сгруппировать данные выборок. 
Для этого разобъем область данных на несколько интервалов равной длины. 
Для первой выборки длину интервала $[a_{j-1}; a_j)$ возьмем равной 
<%= number_in_text(sample[1].hist_step) %>, за $a_0$ возьмем 
<%= number_in_text(sample[1].hist_start) %>. 
Для второй выборки длину интервала $[a_{j-1}; a_j)$ возьмем равной 
<%= number_in_text(sample[2].hist_step) %>, за $a_0$ возьмем 
<%= number_in_text(sample[2].hist_start) %>. 
Вычислим относительные частоты попадания в эти интервалы (табл.~\ref{tab:3} 
и~\ref{tab:4}) и над каждым из них построим столбец соответствующей высоты 
(рис.~\ref{pic3} и~\ref{pic4}).

\begin{table}[h]
  \begin{minipage}[h]{0.49\linewidth}
    \caption{Выборка 1, относительные частоты.}\label{tab:3}
  \end{minipage}
  \begin{minipage}[h]{0.49\linewidth}
    \caption{Выборка 2, относительные частоты.}\label{tab:4}
  \end{minipage}
  \begin{minipage}[t]{0.49\linewidth}
  \begin{center}
    \begin{tabular}{|c|c|}
      \hline
      Интервал & Отн. частота \\
      \hline 
      <% sample[1].hist.to_a.sort.each do |x, f| %>
        $[<%= x %>; <%= x + sample[1].hist_step %>)$ & $<%= f %>$ \\
        \hline
      <% end %>
    \end{tabular}
  \end{center}
\end{minipage}
  \hfill
  \begin{minipage}[t]{0.49\linewidth}
    \begin{center}
      \begin{tabular}{|c|c|}
        \hline
        Интервал & Отн. частота \\
        \hline 
        <% sample[2].hist.to_a.sort.each do |x, f| %>
          $[<%= x %>; <%= x + sample[2].hist_step %>)$ & $<%= f %>$ \\
          \hline
        <% end %>
      \end{tabular}
    \end{center}
  \end{minipage}
\end{table}

\par
На основании построенных гистограмм следует выдвинуть и проверить ряд 
статистических гипотез о виде и параметрах распределения обеих случайных 
величин.

\begin{figure}[t]
  \includegraphics[scale=1]{images/st.3.eps}
  \caption{Гистограмма относительных частот выборки 1.}\label{pic3}
\end{figure}

\begin{figure}[t]
  \includegraphics[scale=1]{images/st.4.eps}
  \caption{Гистограмма относительных частот выборки 2.}\label{pic4}
\end{figure}

\par
<% dist1 = sample[1].distribution %>
<% dist2 = sample[2].distribution %>
<% if dist1.class == dist2.class %>
Из построенных гистограмм видно, что из трех гипотез о нормальном, 
равномерном и экспоненциальном распределении для выборок наиболее 
правдоподобна гипотеза о <%= dist_name(dist1) %> распределении. 
Дополнительные основания для принятия решения в каждом случае 
даст построение так называемых вероятностных бумаг.
<% else %>
Из построенных гистограмм видно, что из трех гипотез о нормальном, 
равномерном и экспоненциальном распределении для первой выборки наиболее 
правдоподобна гипотеза о <%= dist_name(dist1) %>, а для второй~--- 
<%= dist_name(dist2) %> распределении. Дополнительные основания 
для принятия решения в каждом случае даст построение так называемых 
вероятностных бумаг.
<% end %>

\par
Дадим определение вероятностной бумаге. Предположим, что закон теоретической 
функции распределения известен (например, нормальное, экспоненциальное или 
равномерное распределение), но неизвестны параметры этого распределения. 
Нормальное и равномерное распределения определяются двумя параметрами 
$\alpha$ и $\beta$~--- математическим ожиданием и среднеквадратичным 
отклонением, а экспоненциальное распределение одним параметром $\lambda$~---
математическим ожиданием. Тогда теоретическую функцию распределения можно 
рассматривать как зависящую от переменной $x$ и соответствующих параметров: 
$F = F(x, \alpha, \beta)$ или $F = F(x, \lambda)$. Выберем такую систему 
координат $u = u(x)$, $v = v(x)$, чтобы график теоретической функции 
распределения в новых координатах $(u, v)$ стал прямой линией $v = ku+b$ 
с коэффициентами $k$ и $b$, зависящими от неизвестных параметров $\alpha$ 
и $\beta$: $k = \varphi(\alpha, \beta)$, $b = \psi(\alpha, \beta)$. 
Для экспоненциального распределения существует такая система координат,
в которой уравнение прямой имеет вид $v = ku$, где $k = \varphi(\lambda)$.

\par
Поскольку эмпирическая функция распределения $y = F_\text{э}(x)$ при 
достаточно большом объеме выборки лежит вблизи от теоретической функции 
рапределения $y = F(x, \alpha, \beta)$ (или при экспоненциальном 
распределении $y = F(x, \lambda)$), то после замены переменных 
график эмпирической функции должен лежать вблизи искомой прямой. 
Новая система координат $(u, v)$ с нанесенными соответствующими 
значениями $(x, y)$, преобразованными в новые координаты, называется 
вероятностной бумагой. Построив в новых координатах график эмпирической 
функции распределения, подбирают и скомую прямую так, чтобы по обе 
стороны от нее находилось примерно одинаковое количество <<ступенек>> 
построенного графика (это можно делать произвольно, а можно 
воспользоваться, например методом наименьших квадратов). Затем определяют 
$k$~--- величину тангенса угла, образованного этой прямой с осью $Ou$, 
и $b$~--- координату пересечения с осью $Ov$. Приравняв полученные величины 
к $\varphi(\alpha, \beta)$ и $\psi(\alpha, \beta)$, находят оценки 
неизвестных параметров $\alpha$ и $\beta$ из системы уравнений:

$$ 
\begin{cases}
 k = \varphi(\alpha, \beta),\\
 b = \psi(\alpha, \beta).
\end{cases} 
$$

\par
Если неизвестный параметр один (в случае экспоненциального распределения), то 
уравнение будет единственным.

\par
Для нормального закона распределения 
$$  
	F(x, m, \sigma) = \Phi \left( \frac{x-m}{\sigma} \right)  + 0.5,
$$
где $ \Phi(x) = \frac{1}{\sqrt{2 \pi}} \int\limits_{0}^{x} {e^{-\frac{x^2}{2}}} dx$ --- функция Лапласа. Сделаем следующую
замену координат:
$$  
	u = x{,} v = \Phi^{-1}(y-0.5),
$$
где $ x = \Phi^{-1}(y) $ --- функция, обратная к функции Лапласа. В новых координатах $ (u;v) $ уравнение функции распределения $ y = \Phi(\frac{x-m}{\sigma}) + 0.5, $ примет следующий вид:
$$  
	v = \Phi^{-1}(y-0.5) = \Phi^{-1}\left( \Phi \left( \frac{x-m}{\sigma} \right)  + 0.5 - 0.5\right)  = 
$$
$$
	= \Phi^{-1}\left( \Phi \left( \frac{x-m}{\sigma} \right)\right)  = \frac{x-m}{\sigma} = \frac{u-m}{\sigma}.
$$
Получившееся уравнение $ v = \dfrac{u-m}{\sigma} = \dfrac{1}{\sigma} u + (-\dfrac{m}{\sigma})  $
есть уравнение искомой прямой линии. Отсюда

$$
\left\{
\begin{array}{rcl}
k&=&\dfrac{1}{\sigma}\\
b & = &-\dfrac{m}{\sigma}.\\
\end{array}
\right.
\Longleftrightarrow
\left\{
\begin{array}{rcl}
\sigma&=&\dfrac{1}{k}\\
m & = &-\dfrac{b}{k}.\\
\end{array}
\right.
$$

Теоритическая функция распределения экспоненциально распределенной случайной величины имеет вид:

$$
y = F(x, \lambda) =\begin{cases}
1 - e^{- \lambda x},&\text{если $x \geq 0$;}\\
0,&\text{иначе.}\\
\end{cases}
$$

Здесь применяют следующую замену координат: 
$$  
	u = x{,} v = -\ln(1-y).
$$
В новых координатах уравнение теоритической функции распределения $ y = F(x,\lambda) $ примет такой вид:


$$
	v = -\ln(1-y) = -\ln(1-F(x,\lambda)) = -\ln(1-(1-e^{- \lambda x})) = -\ln(e^{- \lambda x}) = \lambda x = \lambda u \text{ } (u \geq 0).
$$

Заметим, что прямая $ v = \lambda u $ должна проходить через начало координат.

Для равномерного распределения имеем следующую теоритическую функцию 
распределения случайной величины:

$$
y = F(x,\alpha,\beta) = \begin{cases}
1,&\text{если $x > \beta$;}\\
\frac{x-\alpha}{\beta-\alpha},&\text{если $x \in [\alpha,\beta]$;}\\
0,&\text{иначе.}\\
\end{cases}
$$

Данная функция уже имеет линейный вид, поэтому можно обойтись тождественным 
преобразованием координат $u = x$, $v = y$. При этом для равномерного 
распределения известны следующие выражения для математического ожидания 
и среднеквадратичного отклонения:

$$
\left\{
\begin{array}{rcl}
m&=&\frac{\alpha+\beta}{2}\\
\sigma&=&\frac{\beta-\alpha}{2\sqrt{3}}.\\
\end{array}
\right.
$$

Имея на вероятностной бумаге линию $kx+b$, исходя из этого, параметры 
распределения можно оценить следующим образом:

$$
\left\{
\begin{array}{rcl}
\alpha&=&-\frac{b}{k}\\
\beta&=&\frac{1-b}{k}.\\
\end{array}
\right.
\Longleftrightarrow
\left\{
\begin{array}{rcl}
m&=&\frac{1-2b}{2k}\\
\sigma&=&\frac{1}{2k\sqrt{3}}.\\
\end{array}
\right.
$$

Для каждой выборки построим вероятностные бумаги равномерного, нормального и 
экспоненциального распределений (для выборки 1~--- 
рис.~\ref{pic5},~\ref{pic6} и~\ref{pic7}, 
для выборки 2~--- рис.~\ref{pic8},~\ref{pic9} и~\ref{pic10}).

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.7.eps}
  \caption{Равномерная вероятностная бумага для выборки 1.}\label{pic5}
\end{figure}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.5.eps}
  \caption{Нормальная вероятностная бумага для выборки 1.}\label{pic6}
\end{figure}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.6.eps}
  \caption{Экспоненциальная вероятностная бумага для выборки 1.}\label{pic7}
\end{figure}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.10.eps}
  \caption{Равномерная вероятностная бумага для выборки 2.}\label{pic8}
\end{figure}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.8.eps}
  \caption{Нормальная вероятностная бумага для выборки 2.}\label{pic9}
\end{figure}

\begin{figure}[h]
  \includegraphics[scale=1]{images/st.9.eps}
  \caption{Экспоненциальная вероятностная бумага для выборки 2.}\label{pic10}
\end{figure}

<% parameters = [] %>

\par
<% if dist1.kind_of?(Statistic::Uniform) %>
  <% k, b = dist1.linear_approx %>
  <% param = dist1.parameters %>
  <% parameters[1] = "$\\sigma = #{roundn(param[:sigma], 4)}$ и 
                      $m = #{roundn(param[:m], 4)}$" %>
  График эмпирической функции распределения выборки $1$ наилучшим образом 
  приближается прямой на равномерной вероятностной бумаге (рис.~\ref{pic5}).
  Оценим параметры распределения выборки 1. Аппроксимирующая прямая $y = kx + b$ 
  выбрана так, что имеет параметры $k = <%= roundn(k, 4) %>$ и 
  $b = <%= roundn(b, 4) %>$.
  Откуда $\sigma = \dfrac{1}{2\sqrt{3}k} \approx 
  <%= roundn(param[:sigma], 4) %>$ и 
  $m = \dfrac{1 - 2b}{2k} \approx <%= roundn(param[:m], 4) %>$.
<% elsif dist1.kind_of?(Statistic::Normal) %>
  <% k, b = dist1.linear_approx %>
  <% param = dist1.parameters %>
  <% parameters[1] = "$\\sigma = #{roundn(param[:sigma], 4)}$ и 
                      $m = #{roundn(param[:m], 4)}$" %>
  График на рис.~\ref{pic5} приближается прямой весьма условно, 
  откуда заключаем, что выборка $1$ не удовлетворяет равномерному распределению.
  Прямая на рис.~\ref{pic7} не проходит через начало координат, 
  следовательно нельзя считать правдоподобной гипотезу о том,
  что выборка $1$ удовлетворяет экспоненциальному распределению. 
  Так как график на рис.~\ref{pic6} мало отклоняется от прямой, то
  можно предположить, что выборка $1$ имеет нормальное распределение.
  Оценим параметры распределения выборки $1$. Аппроксимирующая прямая 
  $y = kx + b$ выбрана так, что имеет параметры $k = <%= roundn(k, 4) %>$ и 
  $b = <%= roundn(b, 4) %>$.
  Откуда $\sigma = \dfrac{1}{k} \approx <%= roundn(param[:sigma], 4) %>$ и 
  $m = -\dfrac{b}{k} \approx <%= roundn(param[:m], 4) %>$.
<% else %>
  <% k, b = dist1.linear_approx %>
  <% param = dist1.parameters %>
  <% parameters[1] = "$\\lambda = #{roundn(param[:lambda], 4)}$" %>
  Для выборки $1$ удалось подобрать прямую для вероятностной бумаги 
  экспоненциального распределения, проходящую через начало координат, 
  которая приближает эмпирическую функцию распределения выборки $1$ лучше, 
  чем прямые на других вероятностных бумагах. Поэтому, предположим, 
  что выборка $1$ имеет экспоненциальное рапределение и оценим его параметры.
  Прямая на вероятностной бумаге (рис.~\ref{pic7}) имеет параметры 
  $k = <%= roundn(k, 4) %>$ и $b = 0$, соответственно 
  параметр распределения $\lambda = <%= roundn(param[:lambda], 4) %>$.
<% end %>

\par
<% if dist2.kind_of?(Statistic::Uniform) %>
  <% k, b = dist2.linear_approx %>
  <% param = dist2.parameters %>
  <% parameters[2] = "$\\sigma = #{roundn(param[:sigma], 4)}$ и 
                      $m = #{roundn(param[:m], 4)}$" %>
  График эмпирической функции распределения выборки $2$ наилучшим образом 
  приближается прямой на равномерной вероятностной бумаге (рис.~\ref{pic8}).
  Оценим параметры распределения выборки $2$. Аппроксимирующая прямая $y = kx + b$ 
  выбрана так, что имеет параметры $k = <%= roundn(k, 4) %>$ и 
  $b = <%= roundn(b, 4) %>$.
  Откуда $\sigma = \dfrac{1}{2\sqrt{3}k} \approx 
  <%= roundn(param[:sigma], 4) %>$ и 
  $m = \dfrac{1 - 2b}{2k} \approx <%= roundn(param[:m], 4) %>$.

<% elsif dist2.kind_of?(Statistic::Normal) %>
  <% k, b = dist2.linear_approx %>
  <% param = dist2.parameters %>
  <% parameters[2] = "$\\sigma = #{roundn(param[:sigma], 4)}$ и 
                      $m = #{roundn(param[:m], 4)}$" %>
  График на рис.~\ref{pic8} приближается прямой весьма условно, 
  откуда заключаем, что выборка $2$ не удовлетворяет равномерному распределению.
  Прямая на рис.~\ref{pic10} не проходит через начало координат, 
  следовательно нельзя считать правдоподобной гипотезу о том,
  что выборка $2$ удовлетворяет экспоненциальному распределению. 
  Так как график на рис.~\ref{pic9} мало отклоняется от прямой, то
  можно предположить, что выборка $2$ имеет нормальное распределение.
  Оценим параметры распределения выборки $2$. Аппроксимирующая прямая 
  $y = kx + b$ выбрана так, что имеет параметры $k = <%= roundn(k, 4) %>$ и 
  $b = <%= roundn(b, 4) %>$.
  Откуда $\sigma = \dfrac{1}{k} \approx <%= roundn(param[:sigma], 4) %>$ и 
  $m = -\dfrac{b}{k} \approx <%= roundn(param[:m], 4) %>$.
<% else %>
  <% k, b = dist2.linear_approx %>
  <% param = dist2.parameters %>
  <% parameters[2] = "$\\lambda = #{roundn(param[:lambda], 4)}$" %>
  Для выборки $2$ удалось подобрать прямую для вероятностной бумаги 
  экспоненциального распределения, проходящую через начало координат, 
  которая приближает эмпирическую функцию распределения выборки $2$ лучше, 
  чем прямые на других вероятностных бумагах. Поэтому, предположим, 
  что выборка $2$ имеет экспоненциальное рапределение и оценим его параметры.
  Прямая на вероятностной бумаге (рис.~\ref{pic10}) имеет параметры 
  $k = <%= roundn(k, 4) %>$ и $b = 0$, соответственно 
  параметр распределения $\lambda = <%= roundn(param[:lambda], 4) %>$.
<% end %>


\newpage

<% 
  def dist_to_text(dist)
    return "равномерном" if dist.kind_of?(Statistic::Uniform)
    return "нормальном" if dist.kind_of?(Statistic::Normal)
    return "экспоненциальном" if dist.kind_of?(Statistic::Exponential)
  end 
%>

\par
{\em Вывод.} На основании построенных гистограмм относительных частот и анализа 
равномерной, нормальной и экспоненциальной вероятностных бумаг можно выдвинуть 
гипотезы о <%= dist_to_text(dist1) %> распределении выборки 1 с параметрами 
<%= parameters[1] %>, и <%= dist_to_text(dist2) %> распределении выборки 2 
с параметрами <%= parameters[2] %>. 

\endinput
