
<% require 'yaml' %>

<% global = YAML.load_file("data/global.yaml") %>
<% data = YAML.load_file("data/#{global['variant']}.yaml") %>

<% require 'statistic' %>
<% require 'latex_helper' %>
<% include LatexHelper %>

<%
sample = {}
for i in 1 .. 7
  sample[i] = Statistic::Sample::new(data[i]['data'])
  sample[i].hist_step = data[i]['histstep'] if data[i]['histstep']
  sample[i].hist_start  = data[i]['histstart'] if data[i]['histstart']
end

total = Statistic::Sample::new(data[5]['data'] + data[6]['data'] + data[7]['data'])
%>

\subsection*{\hspace*{\parindent}Задание 9}
С помощью факторного дисперсионного анализа проверить гипотезу
о равенстве математических ожиданий оценок для указанных в задании 8 
для своего варианта предметов с
уровнем значимости $<%= 0.1 %>$.

\par
{\em Решение.}
Пусть фактор $F$ (изучаемая дисциплина) имеет $k$ уровней ($k = 3$,
так как изучается три дисциплины). Случайная величина $\xi$ (успеваемость) 
наблюдается у каждого студента при каждом значении фактора $F$. 
На основании этих данных требуется установить, значимо ли влияет фактор $F$
на среднее значение величины $\xi$ или разница наблюдений обусловлена 
случайными колебаниями. Если влияние фактора существенно, значит дисциплины 
имеют разную сложность или оцениваются преподавателями с разной
степенью строгости.

Чтобы сделать соответствующий вывод, примем нулевую гипотезу $H_0$ о равенстве 
всех трех математических ожиданий: $M(\xi_1) = M(\xi_2) = M(\xi_3)$, 
где $\xi_1$, $\xi_2$, $\xi_3$~--- случайные оценки успеваемости
по предметам <<<%= data[5]['title'] %>>>, <<<%= data[6]['title'] %>>>  и 
<<<%= data[7]['title'] %>>> соответственно.
Конкурирующая гипотеза $H_1$ состоит в том, что не все они равны, то есть 
хотя бы два из трех математических ожиданий различаются.

Для принятия решения определим выборочные средние $\overline{x}_1$, $\overline{x}_2$ и $\overline{x}_3$
для каждого столбца наблюдений (групповые средние) и $\overline{x}$~--- выборочную среднюю всех наблюдений:
$$
	\overline{x}_1 = \dfrac{\sum\limits_{i=1}^n\,x_{i1}}n,\quad\overline{x}_2 = \dfrac{\sum\limits_{i=1}^n\,x_{i2}}n,\quad\overline{x}_3 = \dfrac{\sum\limits_{i=1}^n\,x_{i3}}n,\quad\overline{x} = \dfrac{\sum\limits_{j=1}^k\sum\limits_{i=1}^n\,x_{ij}}{kn}.
$$

<%
n = sample[5].size

xj = (5..7).map { |i| sample[i].mean }
x = total.mean
sum_c = total.data.map{ |val| (val - x)**2}.reduce(:+)
sum_f = n*xj.map { |e| (e - x)**2 }.reduce(:+)
sum_r = (5..7).map { |j| sample[j].data.map { |e| (e - sample[j].mean)**2}.reduce(:+) }.reduce(:+)
s_c = sum_c / (3.0*n-1)
s_f = sum_f / 2.0
s_r = sum_r / (3.0*(n-1))
f0 = 2.364615
xj = xj.map { |xv| roundn(xv, 5) }
x = roundn(x, 5)
sum_c = roundn(sum_c, 5)
sum_f = roundn(sum_f, 5)
sum_r = roundn(sum_r, 5)
s_c = roundn(s_c, 5)
s_f = roundn(s_f, 5)
s_r = roundn(s_r, 5)
f1 = roundn(s_f / s_r, 6)
%>

Затем найдем суммы квадратов отклонений:
\begin{enumerate}
 \renewcommand{\labelenumi}{\theenumi)}
 \item ${\sum_{\text{общ}} = \sum\limits_{j=1}^k\sum\limits_{i=1}^n\,(x_{ij} - \overline{x})^2}$~--- 
 общую сумму;
 \item ${\sum_{\text{факт}} = n\sum\limits_{j=1}^k\,(\overline{x}_j - \overline{x})^2}$~--- 
 факторную сумму;
 \item ${\sum_{\text{ост}} = \sum\limits_{j=1}^k\sum\limits_{i=1}^n\,(x_{ij} - \overline{x}_j)^2}$~--- 
остаточную сумму квадратов отклонений наблюдений от групповых средних. 
\end{enumerate}

Можно доказать, что $\sum_{\text{общ}} = \sum_{\text{факт}} + \sum_{\text{ост}}$. 
Для вычисления соответствующих исправленных выборочных дисперсий разделим первую 
сумму на $nk - 1$ (при $k = 3$ и $n = <%= n %>$ будем делить на $<%= 3*n-1 %>$), 
вторую на $k - 1$ (в нашей задаче на 2), третью на $k(n -1)$ (фактически на
$<%= 3*(n-1) %>$), получим:
$$
	S_{\text{общ}}^{*2} = \dfrac{\sum_{\text{общ}}}{<%= 3*n-1 %>},\quad S_{\text{факт}}^{*2} = \dfrac{\sum_{\text{факт}}}2,\quad S_{\text{ост}}^{*2} = \dfrac{\sum_{\text{ост}}}{<%= 3*(n-1) %>}.
$$

Теперь сравним по критерию Фишера теоретические факторную и остаточную дисперсии. Первая обусловлена
отклонениями, связанными с влиянием значения фактора $F$, вторая~--- случайными отклонениями. Если
остаточная дисперсия больше факторной, то влияние фактора на разброс наблюдений незначительно по сравнению
со случайными воздействиями, и можно предположить, что во всех трех случаях речь идет о реализации одной
и той же случайной величины. Как следствие, делается вывод о равенстве всех математических ожиданий.
В противном случае влияние фактора будет решающим, и в предположении равенства теоретических дисперсий
трех различных случайных нормально распределенных величин останется сделать вывод о несовпадении их
математических ожиданий.

Примем в качестве вспомогательной гипотезу $\tilde{H}_0$ о равенстве факторной и остаточной дисперсии
при конкурирующей гипотезе $\tilde{H}_1$ о том, что факторная дисперсия больше остаточной 
(если факторная дисперсия меньше остаточной, то вывод будет такой же, как и при 
равенстве, а критерий Фишера заставит нас принять гипотезу $\tilde{H}_0$ как 
хоть и неправдоподобную, но более предпочтительную, чем $\tilde{H}_1$).

Решающее правило теперь будет выглядеть так:
\begin{enumerate}
\renewcommand{\labelenumi}{\theenumi)}
 \item Если $S_{\text{факт}}^{*2} \leqslant S_{\text{ост}}^{*2}$ , то принимаем гипотезу $\tilde{H}_0$, так как гипотеза о равенстве теоретических дисперсий предпочтительнее, чем гипотеза о том, что
$D_{\text{факт}} > D_{\text{ост}}$. Соответственно, будет принята основная гипотеза $H_0$ о совпадении
всех математических ожиданий.
\item Если $S_{\text{факт}}^{*2} > S_{\text{ост}}^{*2}$, то требуется дополнительное исследование. Следует вычислить $F_{\text{набл}} = \dfrac{S_{\text{факт}}^{*2}}{S_{\text{ост}}^{*2}}$, затем найти критическое значение $F_{\text{крит}}(\alpha;k_1;k_2)$ в распределении Фишера-Снедекора, где $\alpha = <%= 0.1 %>$~---
уровень значимости; $k_1 = k - 1 = 2$, $k_2 = k(n-1) = 3\cdot<%= n-1 %> = <%= 3*(n-1) %>$~--- числа
степеней свободы.\\
 \item Если $F_{\text{набл}} > F_{\text{крит}}$, то гипотезу $\tilde{H_0}$ отвергаем с уровнем значимости $\alpha$ и соответственно отвергаем основную гипотезу $H_0$ о равенстве всех трех математических ожиданий. В противном случае нет оснований отвергнуть гипотезу $\tilde{H_0}$ и, следовательно, гипотеза $H_0$ также принимается.
\end{enumerate}

Проведем анализ для выборок из табл.~\ref{tab:13}. Имеем:

$
\overline{x}_1 = <%= xj[0] %>;\quad\overline{x}_2 = <%= xj[1] %>;\quad\overline{x}_3 = <%= xj[2] %>;\quad\overline{x} = <%= x %>;
$

$
\sum\nolimits_{\text{общ}} = <%= sum_c %>;\quad\sum\nolimits_{\text{факт}} = <%= sum_f %>;\quad\sum\nolimits_{\text{ост}} = <%= sum_r %>;
$

Проверка:
$$
	\sum_{\text{факт}} + \sum_{\text{ост}} = <%= sum_f %> + <%= sum_r %> = <%= sum_f + sum_r %> \approx <%= sum_c %> = \sum_{\text{общ}}.
$$
Далее,
$$
	S_{\text{общ}}^{*2} = \dfrac{\sum_{\text{общ}}}{nk-1} = \dfrac{<%= sum_c %>}{<%= n %>\cdot3 - 1} = <%= s_c %>;
$$
$$
	S_{\text{факт}}^{*2} = \dfrac{\sum_{\text{факт}}}{k-1} = \dfrac{<%= sum_f %>}2 = <%= s_f %>;
$$
$$
	S_{\text{ост}}^{*2} = \dfrac{\sum_{\text{ост}}}{k(n-1)} = \dfrac{<%= sum_r %>}{3(<%= n %> - 1)} = <%= s_r %>;
$$

Так как $S_{\text{факт}}^{*2} = <%= s_f %> > <%= s_r %> = S_{\text{ост}}^{*2}$, то применяем критерий
Фишера:
$$
	F_{\text{набл}} = \dfrac{S_{\text{факт}}^{*2}}{S_{\text{ост}}^{*2}} = \dfrac{<%= s_f %>}{<%= s_r %>} = <%= f1 %>;
$$
$$
	F_{\text{крит}} = t_2(1 - \alpha;k-1;k(n-1)) = t_2(<%= 0.9 %>;2;<%= 3*(n-1) %>) = <%= f0 %>.
$$

Так как $F_{\text{набл}} = <%= f1 %> > <%= f0 %> = F_{\text{крит}}$, то гипотезу $\tilde{H_0}$, а,
следовательно, и гипотезу $H_0$ о равенстве всех математических ожиданий отвергаем с уровнем значимости
$<%= 0.1 %>$. Влияние фактора на разброс наблюдений значительно по сравнению со случайными воздействиями,
значит, дисциплины имеют разную сложность или оцениваются преподавателями с разной степенью строгости.


\endinput
